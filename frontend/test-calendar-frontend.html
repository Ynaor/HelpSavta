<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calendar Integration Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        .test-container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-section {
            margin-bottom: 30px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .test-result {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
        }
        .success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .loading {
            background-color: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        button {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background-color: #0056b3;
        }
        pre {
            background-color: #f8f9fa;
            padding: 10px;
            border-radius: 4px;
            overflow-x: auto;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>🧪 Calendar Integration Test</h1>
        <p>This page tests the calendar functionality outside of the React app to isolate issues.</p>
        
        <div class="test-section">
            <h2>📡 API Connection Test</h2>
            <button onclick="testAPIConnection()">Test API Connection</button>
            <div id="api-result"></div>
        </div>
        
        <div class="test-section">
            <h2>🔐 Authentication Test</h2>
            <button onclick="testLogin()">Test Login</button>
            <button onclick="testAuthStatus()">Check Auth Status</button>
            <div id="auth-result"></div>
        </div>
        
        <div class="test-section">
            <h2>📅 Calendar Data Test</h2>
            <button onclick="testCalendarData()">Test Calendar Data</button>
            <div id="calendar-result"></div>
        </div>
        
        <div class="test-section">
            <h2>🌐 Frontend App Test</h2>
            <button onclick="openCalendarPage()">Open Calendar Page</button>
            <button onclick="openDevTools()">Open Browser DevTools</button>
            <div id="frontend-result"></div>
        </div>
    </div>

    <script>
        const API_BASE = 'http://localhost:3001/api';
        
        function log(elementId, message, type = 'loading') {
            const element = document.getElementById(elementId);
            const resultDiv = document.createElement('div');
            resultDiv.className = `test-result ${type}`;
            resultDiv.innerHTML = message;
            element.appendChild(resultDiv);
        }
        
        function clearLogs(elementId) {
            document.getElementById(elementId).innerHTML = '';
        }
        
        async function testAPIConnection() {
            clearLogs('api-result');
            log('api-result', '🔄 Testing API connection...', 'loading');
            
            try {
                const response = await fetch(`${API_BASE}/auth/status`, {
                    credentials: 'include'
                });
                
                if (response.ok) {
                    const data = await response.json();
                    log('api-result', `✅ API connection successful: ${JSON.stringify(data)}`, 'success');
                } else {
                    log('api-result', `⚠️ API responded with status: ${response.status}`, 'error');
                }
            } catch (error) {
                log('api-result', `❌ API connection failed: ${error.message}`, 'error');
            }
        }
        
        async function testLogin() {
            clearLogs('auth-result');
            log('auth-result', '🔄 Testing login...', 'loading');
            
            try {
                const response = await fetch(`${API_BASE}/auth/login`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    credentials: 'include',
                    body: JSON.stringify({
                        username: 'your-admin-username',
                        password: 'your-admin-password'
                    })
                });
                
                const data = await response.json();
                
                if (response.ok && data.success) {
                    log('auth-result', `✅ Login successful: ${data.message}`, 'success');
                    log('auth-result', `👤 User: ${JSON.stringify(data.data)}`, 'success');
                } else {
                    log('auth-result', `❌ Login failed: ${data.error || data.message}`, 'error');
                }
            } catch (error) {
                log('auth-result', `❌ Login error: ${error.message}`, 'error');
            }
        }
        
        async function testAuthStatus() {
            clearLogs('auth-result');
            log('auth-result', '🔄 Checking auth status...', 'loading');
            
            try {
                const response = await fetch(`${API_BASE}/auth/status`, {
                    credentials: 'include'
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    log('auth-result', `✅ Auth status: ${JSON.stringify(data)}`, 'success');
                } else {
                    log('auth-result', `❌ Auth check failed: ${data.error || data.message}`, 'error');
                }
            } catch (error) {
                log('auth-result', `❌ Auth check error: ${error.message}`, 'error');
            }
        }
        
        async function testCalendarData() {
            clearLogs('calendar-result');
            log('calendar-result', '🔄 Testing calendar data...', 'loading');
            
            // Calculate this week's date range
            const today = new Date();
            const startOfWeek = new Date(today);
            startOfWeek.setDate(today.getDate() - today.getDay());
            const endOfWeek = new Date(startOfWeek);
            endOfWeek.setDate(startOfWeek.getDate() + 6);
            
            const startDate = startOfWeek.toISOString().split('T')[0];
            const endDate = endOfWeek.toISOString().split('T')[0];
            
            log('calendar-result', `📅 Date range: ${startDate} to ${endDate}`, 'loading');
            
            try {
                const url = `${API_BASE}/admin/calendar-data?startDate=${startDate}&endDate=${endDate}&view=week`;
                log('calendar-result', `🌐 Calling: ${url}`, 'loading');
                
                const response = await fetch(url, {
                    credentials: 'include'
                });
                
                const data = await response.json();
                
                if (response.ok && data.success) {
                    log('calendar-result', `✅ Calendar data received successfully!`, 'success');
                    log('calendar-result', `📊 Events count: ${data.data.events?.length || 0}`, 'success');
                    log('calendar-result', `👤 User role: ${data.data.userRole}`, 'success');
                    log('calendar-result', `<pre>${JSON.stringify(data.data, null, 2)}</pre>`, 'success');
                } else {
                    log('calendar-result', `❌ Calendar data failed: ${data.error || data.message}`, 'error');
                }
            } catch (error) {
                log('calendar-result', `❌ Calendar data error: ${error.message}`, 'error');
            }
        }
        
        function openCalendarPage() {
            clearLogs('frontend-result');
            log('frontend-result', '🔄 Opening calendar page...', 'loading');
            window.open('http://localhost:3000/admin/calendar', '_blank');
            log('frontend-result', '✅ Calendar page opened in new tab. Check console for errors.', 'success');
        }
        
        function openDevTools() {
            clearLogs('frontend-result');
            log('frontend-result', '📋 Instructions: Press F12 or right-click → Inspect Element', 'loading');
            log('frontend-result', '🔍 Check the Console tab for any JavaScript errors', 'loading');
            log('frontend-result', '📡 Check the Network tab for failed API requests', 'loading');
        }
        
        // Auto-run basic tests on load
        window.onload = function() {
            testAPIConnection();
        };
    </script>
</body>
</html>